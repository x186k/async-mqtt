<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>title</title>
    <xlink rel="stylesheet" href="style.css">

     
        <script src="xmqtt.umd.js"></script>
   

        <script>
            // @ts-check
           
            window.localStorage.setItem('debug', '*,-mqtt*');
           // window.localStorage.setItem('debug', '*');
         
            // @ts-ignore
           // const mqtt = new window.AsyncClient()
            //const mqtt = require('browserAsyncMqtt')
            //const topic = 'uU2fD3uY9zP7nH7oI'

            console.log(999,xmqtt)
            //ff

           // mqtt.publish("wow/so/cool", "It works!");

            run()

            async function run() {
                const client = await xmqtt.connectAsync('wss://test.mosquitto.org:8081')

                client.foo()
                
                client.on('message', function (topic, message) {
                    // message is Buffer
                    console.log('--rx', message.toString())
                    //client.end()
                })


                console.log("Starting");
                try {

                    await client.subscribe("wow/so/cool")
                    await client.publish("wow/so/cool", "It works!");
                    // This line doesn't run until the server responds to the publish

                    // await client.end();
                    // This line doesn't run until the client has disconnected without error
                    console.log("Done");
                } catch (e) {
                    // Do something about it!
                    console.log(e.stack);
                    //process.exit();
                }
            }

        </script>
</head>

<body>
    <!-- page content -->
    foo bar
</body>

</html>